
# 目的

- データ連携機能関連の設計工程以降の開発範囲を明確にする
- データ連携機能関連の設計工程以降の見積漏れ防止

# データ連携機能　開発範囲
## データ連携全体概要
![image](https://github.com/ShopChannelIT/Vendor-Potal-Systme/assets/88366591/f4c151fe-6af8-43e7-841e-f82af3fc65a1)

## データ連携ルール（開発範囲①)
| 項目 | 内容 | ポイント |
| - | - | - |
| データ連携要件 | 基幹システム業務データのうち、日々差分(追加・変更・削除データ)を所定フォルダへcsv形式で作成する | \\WIN-FIL-01\K_Drive\定期削除\O\kintone\ |
| 連携データ作成方針 | 基幹DB定義書の全項目をレイアウトとおり作成する<br>-.マスターデータ：一意のキー単位に連携する。親子関係のマスター（例：取引先と取引先部門）は、結合して連携する。基幹システムの削除データは、削除フラグを連携する。<br><br>-.トランザクションデータ：ヘッダーと明細を結合し全項目を連携する。ヘッダーのみ変更あった場合は、全明細を結合する。明細のみ変更あった場合は、対象のヘッダーを結合して連携する。基幹システムの削除データは、削除フラグを連携する。<br><br>-抽出対象データ<br>件数が少ないマスター系は全件抽出対象とする、もしくは過去48時間(抽出処理実行時間起点)以内に更新されたデータを対象とする。 | 各データの一意のキーは■データ詳細参照 |
| 区分・フラグ・コード | リソースデータが存在しない区分値やフラグ等は、区分・名称管理マスターをCSV連携する(StepA開発対象外) | 区分・名称マスター参照ルールは別途記載する |
| 連携頻度 | ■データ詳細参照 | 実行時間：平日 9:30-18:00 |
| CSV命名ルール<br>CSV更新方法 | 基幹システムの命名ルールに沿う |  |
| CSVファイルの文字コード | UTF-8 |  |
## データ連携ルール（開発範囲②)

開発期間：3/1~4/15、4/15以降は結合テスト

| 項目 | 内容 | ポイント |
| - | - | - |
| 開始条件 | ・Kintoneアプリbが2:処理終了である事を確認しaを1:処理中へ更新した後、csvから基幹データ取込層への処理を開始する。処理終了後、aを2:処理終了へ更新する<br><br>a:基幹データ取込層処理中フラグ： 1:処理中 2:処理終了<br>bデータ加工層処理中フラグ： 1:処理中 2:処理終了<br><br>・Kintoneアプリbが1:処理中の場合、実行しない。次回スケジュール実行にて処理する<br> | csv⇒kintone基幹データ取込層更新中は、データ加工層処理を実行しないようにする |
| データ連携要件 | ・所定フォルダのcsvファイルをkintone 基幹データ取込層へデータ更新する<br>・kintone 基幹データ取込層に、同一キーデータが存在する場合は更新(update)し、同一キーデータが無ければ追加(insert)する<br>・kintone 基幹データ取込層は、開発環境/本番(ステージング)/本番の3環境へ連携できるよう対応する | OneDrive or SharePoint |
| 連携データ処理方針 | csvファイルと同レイアウトのkintone 基幹データ取込層へデータへデータ移送するのみとする。条件分岐や条件判定等のロジックを保持しない |  |
| スケジュール実行<br>連携頻度 | スケジュール実行を可能とする、最短で15分間隔で実行する<br>リカバリー用に手動実行を可能とする | 実行時間：平日9:30-18:00まで |
| ログ | いつ、誰が、何を(csv)、何件処理したのか、正常・異常終了のログを出力する | ログ保持期間は、90日 |
| CSVファイルの文字コード | UTF-8 |  |

## 開発分担案
| 範囲№ | 開発範囲 | 開発者<br>パタン2 | 開発概要 | 前提条件 |
| - | - | - | - | - |
| ① | 基幹システム業務<br>データ抽出 | JSC-IT | 基幹システムの業務データを所定のルールに沿ってファイルサーバ(kドライブ)へCSV出力する |  |
| ② | 基幹データ取込層 | コムチュア | ファイルサーバのCSVファイルをKintone環境へ取込む、原則、CSVファイルと同一レイアウトとし取込み、kintone内へデータを蓄積する | 基幹データ取込層レイヤー内処理、他の層へのアクセス禁止 |
| ③ | ベンダーポータル<br>データ加工層 | コムチュア | 今回開発するKintoneアプリ向けに必要なデータ集計・加工を行う |  |
| ③ | ベンダーポータル<br>利用者向け公開アプリ層 | コムチュア |  |  |

## 開発範囲①②
### データ詳細 kintone基幹データ取込層ER図
![image](https://github.com/ShopChannelIT/Vendor-Potal-Systme/assets/88366591/b723aedd-a3fe-4979-b61c-56a29ae1a090)


### 基幹システム⇒CSV⇒kintone基幹データ取込層明細
| № | 基幹システムデータ | CSV№ | Kintone  基幹データ取込層 | キー | 実行頻度 |
| - | - | - | - | - | - |
| 1 | 取引先マスター | 1 | 取引先&取引先部門マスター | 取引先コード/取引先部門コード | 1時間間隔/10:00-18:00 |
| 2 | 取引先部門マスター | ー | 同上 |  |  |
| 3 | ショウマスター | 2 | ショウマスター&ショウマスター明細 | ショウコード/ショウ明細連番 | ４回/1時間/9:30-18:00 |
| 4 | ショウマスター明細 | ー | 同上 |  |  |
| 5 | 検品所マスター | 3 | 検品所マスター | 検品所コード | 1時間間隔/10:00-18:00 |
| 6 | 媒体マスター | 4 | 媒体マスター | 媒体コード | 1時間間隔/10:00-18:00 |
| 7 | ブランドマスター | 5 | ブランドマスター | ブランドコード | 1時間間隔/10:00-18:00 |
| 8 | カテゴリマスター | 6 | カテゴリマスター | カテゴリコード | 1時間間隔/10:00-18:00 |
| 9 | 商品基本マスター | 7 | 商品基本マスター | 商品基本コード | 15分間隔/10:00-18:00 |
| 10 | 商品基本色サイズマスター | 8 | 商品基本色サイズマスター | 商品基本コード/商品基本色サイズコード | 15分間隔/10:00-18:00 |
| 11 | 商品サイズ名称マスター | 9 | 商品サイズ名称マスター | 商品基本サイズコード | 15分間隔/10:00-18:00 |
| 12 | 商品色名称マスター | 10 | 商品色名称マスター | 商品基本色デザインコード | 15分間隔/10:00-18:00 |
| 13 | 仮商品基本マスター | 11 | 仮商品基本マスター | 商品基本コード | 15分間隔/10:00-18:00 |
| 14 | 仮商品基本色サイズマスター | 12 | 仮商品基本色サイズマスター | 商品基本コード/商品基本色サイズコード | 15分間隔/10:00-18:00 |
| 15 | SHOP№管理マスター | 13 | SHOP№管理マスター | 申込商品番号 | 15分間隔/10:00-18:00 |
| 16 | WIL | 14 | WIL&WIL明細 | WIL番号/WIL明細番号 | 15分間隔/10:00-18:00 |
| 17 | WIL明細 | ー | 同上 |  |  |
| 18 | プロダクトシートデータチェック管理 | 15 | プロダクトシートデータチェック管理 | 申込商品番号/プロダクトシートデータ<br>チェック識別コード/プロダクトシート<br>データチェック連番 | 15分間隔/10:00-18:00 |
| 19 | 発注 | 16 | 発注＆発注明細 | 発注番号/発注連番 | 15分間隔/10:00-18:00 |
| 20 | 発注明細 | ー | 同上 |  |  |
| 21 | 発注条件書指示履歴 | 17 | 発注条件書指示履歴 | 発注条件書指示履歴連番/<br>発注条件書指示履歴枝番 | 15分間隔/10:00-18:00 |
| 22 | 搬入指示 | 18 | 搬入指示＆搬入指示明細 | 発注番号/発注連番/納入回数 | 15分間隔/10:00-18:00 |
| 23 | 搬入指示明細 | ー | 同上 |  |  |
| 24 | 検品指示 | 19 | 検品指示 | 発注番号/納入回数/検品場所コード | 15分間隔/10:00-18:00 |
| 25 | 商品基本明細報告書版管理 | 20 | 商品基本明細報告書版管理&<br>報告書版管理明細 | 商品基本コード/報告書管理番号/<br>報告書枝番/報告書版番号 | 15分間隔/10:00-18:00 |
| 26 | 報告書版管理明細 | ー | 同上 |  |  |
| 27 | デフォルメ販売商品 | 21 | デフォルメ&デフォルメ販売商品 | 申込商品番号/デフォルメ依頼番号<br>/デフォルメ販売商品連番 | 15分間隔/10:00-18:00 |
| 28 | デフォルメ | ー | 同上 |  |  |
| 29 | 倉庫マスター | 22 | 倉庫別場所マスター | 倉庫コード/倉庫場所コード | 1時間間隔/10:00-18:00 |
| 30 | 倉庫場所マスター | ー | 同上 |  |  |
| 31 | 倉庫別場所 | ー | 同上 |  |  |  |  |
